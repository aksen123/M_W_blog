---
description: 2024년 3월 4일
tags: [dayjs, 달력]
title: dayjs로 달력만들기!
---

:::tip 오늘은!
dayjs로 만두 어드민 페이지에서 매출달력 만든 부분에 대해서 작성할건데 기본적인건 공식페이지에 잘 나와있으니 여기엔 내가 사용한것만 기록해보겠다!!!
:::

<br /><br />

### dayjs 장점

1. 간편한 API: Day.js는 직관적이고 간결한 API를 제공하여 날짜와 시간을 다루는 작업을 쉽게 할 수 있다
2. 가볍고 빠름: Day.js는 무겁지 않고 가벼워서 프로젝트에 쉽게 통합할 수 있고, 실행 속도가 빠르기 때문에 대규모 애플리케이션에서도 효율적으로 사용할 수 있다.

### [기본적인 내용들은 여기서](https://day.js.org/docs/en/installation/installation)

```js
// 현재 날짜
let now = dayjs(); //  === new Date()

// 타임스탬프
now.valueOf(); // 현재시간의 타임스탬프 출력해줌

// 날짜 출력하기 >> format()
now.format("YYYY-MM-DD"); // 2024-03-04

// 현재 달의 첫번째 날짜, 마지막 날짜 출력하기 >> startOf(), endOf()
now.startOf("month").format("YYYY-MM-DD"); // 2024-03-01 출력
now.endOf("month").format("YYYY-MM-DD"); // 2024-03-31 출력

// 이번달 1일의 요일찾기 >> day()
now.day(); // 3월 1일이 금요일이니까 >> 5 출력

// 이번달 길이(마지막 날짜)
now.daysInMonth(); // 3월은 31일까지 있으니까! >> 31 출력

// 기준 날짜에서 n일 이후, 이전 날짜 구하기 (연도, 달에도 사용 가능)
now.startOf("month").add(n, "day"); // n이 3이고 기준날짜가 3월4일 이라면 3월7일을 나타냄
now.startOf("month").subtract(n, "day"); // n이 5이고 기준날짜가 3월4일 이라면 2월29일을 나타냄(올해는 윤년이니까~)
```

#### 위에 작성한것들이 내가 매출달력 페이지에서 사용한것들임!

> 기존에 `new Date()`로 달력을 만들때 나는 12월의 마지막 날짜들을 다 배열에 넣은뒤 2월은 윤년을 구하는 함수를 만들고 29일로 바꾸면서 ..이런 짓들을 했는데 dayjs를 사용하니 이런 불필요한 과정들은 건너뛸수 있었고 상대적으로 간단히 달력을 만들수 있었다!

### 프로젝트에 적용 한 방법

![alt text](./img/dayjs1.png)

> 달력을 보면 현재 월 앞뒤에 빈 공간에 전,후 달의 날짜가 나오는데, 매출달력 페이지도 이렇게 만들고 싶었다(여기에 해당 날짜들의 매출도 같이 보이게) 그래서 어떻게 했냐~
>
> > 1.  달력에 표시될 날짜를 구할 변수들을 구해둠
> > 2.  구해둔 변수들을 사용해 매출데이터를 갖고올 범위를 지정, 범위안 데이터를 갖고 옴 (위 사진을 기준으로 하자면 2/25 ~ 4/6까지)
> > 3.  갖고온 데이터에서 `filter`를 사용해 해당 날짜에 넣어준다.

```js
useEffect(()=>{

  const 현재월 = dayjs(`${받아온 연도}.${받아온 달}.01`)
  // recoil로 관리 하는 연도와 달을 받아와서 넣어 줌(달력에 표시해줄 월)

  const 첫날의요일 = 현재월.day()
  // 3월 1일이 금요일이라 5인데 여기서 앞에 빈공간 갯수와 같아서 전 달의 날짜를 넣어줄때 사용

  const 마지막날짜 = 현재월.dayIsMonth() // 31
  // 화면에 보여질 배열에 넣을때 사용하기위해 필요함

  const 달력뒤빈공간 = 7 - ((마지막날짜 + 첫날의요일) % 7) // 6
  // 달력 빈공간에 넣을 다음달 날짜! 값이 7이면 다음달 날짜는 넣을필요 없음

  const 달력배열 = []; // 화면에 보여질 날짜들을 담은 배열

  // 갖고올 데이터의 범위(타임스탬프)
  const 범위 = {
    시작: 현재월.subtract(첫날의요일, "day").valueOf(),
    끝: 현재월
        .endOf("month")
        .add(달력뒤빈공간 == 7 ? 0 : 달력뒤빈공간, "day")
        .valueOf(),
  }

  // 매출 데이터 갖고와서 배열에 같이 넣어 주기
  const 데이터갖고오기 = async ()=>{

    const 매출 = await 비동기데이터갖고오기(범위)

    // 이전달의 날짜 넣어주기!
    for(let i = 첫날의요일; i > 0; i--){
      // i의 해당하는 날짜의 매출이 있는지 확인후 해당 데이터가 있으면 달력 배열에 같이 넣어준다 (없으면 빈배열)
      달력배열.push({
        날짜 : 현재월.startOf("month").subtract(i, "day").date(),
        매출 : 매출데이터,
        })
    }

    // 이번달 날짜들 넣어주기!
   for(let i = 1; i <=마지막날짜; i++) {
    // 같은 방식으로 i날짜의 데이터를 찾아서 넣어줌
    달력배열.push({날짜 :i, 매출: 매출데이터})
   }

   // 다음달 날짜 넣어주기!
   if(달력뒤빈공간 < 7) {
     // 같은 방식으로 i날짜의 데이터를 찾아서 넣어줌
     for(let i  = 1; i <= 달력뒤빈공간; i++){
      달력배열.push({날짜 :i, 매출: 매출데이터})
    }
   }

    set달력(달력배열)
  }

  매출갖고오기()

},[연도,월을 담고있는 객체])

```

<br />
이런식으로 만들었는데 실제 코드는 너무 지저분 하달까.. 뭔가 마음에 안든다.. 일단 호다닥 만들고 다시 리팩토링 하는 방향으로 가야할듯..!!! 일단 오늘은 20000 ~ 이제 매출 상세 페이지 만들러 가야지..✌️

## 수정사항! (24.03.11)

> 위 방식으로 코드를 작성했는데 데이터를 클라이언트에서 수정 하기보단 서버에서 수정한뒤 클라이언트에선 화면에 출력만 해주는 방식이 더 좋다는 피드백을 받아서 코드를 수정 했다!

### 코드 수정 내용~

```js title="클라이언트"
useEffect(()=>{

  const 현재월 = dayjs(`${받아온 연도}.${받아온 달}.01`)
  // recoil로 관리 하는 연도와 달을 받아와서 넣어 줌(달력에 표시해줄 월)

  const 첫날의요일 = 현재월.day()
  // 3월 1일이 금요일이라 5인데 여기서 앞에 빈공간 갯수와 같아서 전 달의 날짜를 넣어줄때 사용

  const 마지막날짜 = 현재월.dayIsMonth() // 31
  // 화면에 보여질 배열에 넣을때 사용하기위해 필요함

  const 달력뒤빈공간 = 7 - ((마지막날짜 + 첫날의요일) % 7) // 6
  // 달력 빈공간에 넣을 다음달 날짜! 값이 7이면 다음달 날짜는 넣을필요 없음

  // 갖고올 데이터의 범위(타임스탬프)
  const 범위 = {
    시작: 현재월.subtract(첫날의요일, "day").valueOf(),
    끝: 현재월
        .endOf("month")
        .add(달력뒤빈공간 == 7 ? 0 : 달력뒤빈공간, "day")
        .valueOf(),
  }

  // 매출 데이터 갖고와서 배열에 같이 넣어 주기
  const 데이터갖고오기 = async ()=>{
    const 매출 = await 비동기데이터갖고오기(범위)
    set달력(매출)
  }

  매출갖고오기()

},[연도,월을 담고있는 객체])

```

<br /><br />

```ts title="api"
function 매출데이터갖고오기(request: NextRequest) {
  // 클라이언트에서 보내준 범위
  const { searchParam } = request.nextUrl;
  const start = searchParams.get("start");
  const end = searchParams.get("end");

  // 3월 달력 기준으로 4월6일에서 2월25일 빼기 >> 41
  const 날짜차이 = dayjs(end && +end).diff(start && +start, "day");

  const 매출범위 = query(
    collection(데이터베이스, "payment"),
    where("date", ">=", start && +start),
    where("date", "<=", end && +end)
  );
  const 매출들 = await getDocs(매출범위);
  let 매출배열 = 매출범위.docs.map((doc) => ({
    ...doc.data(),
  })) as Sales[];

  // ...맨처음 클라이언트에서 했던 방식으로 여기서 달력 배열을 만들어 준다!
  //
  //

  return Response.json({ success: true, data: { 달력배열, 해당월매출 } });
}
```

**이런식으로 api에서 데이터를 수정하고 보내준뒤 클라이언트에서는 받아서 출력만 해주는 방식으로 변경했다! 이렇게 하면 수정사항이 있을때 api에서만 수정해주면 되기 때문에 유지보수가 간편해짐!**
