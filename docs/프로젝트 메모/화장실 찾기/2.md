---
title: 화장실 데이터 넣기
---

:::tip ✔️

전국의 화장실 데이터(엑셀파일)를 받아서 DB에 저장하던 중 겪었던 문제점?들을 기록!

[화장실데이터 받는곳](https://www.localdata.go.kr/lif/lifeCtacDataView.do)

[엑셀파일 mariaDB에 넣는 법](/docs/MariaDB/3.md)

:::

## 겪었던 문제들

<br />

### 1. 데이터에 위도,경도가 없음

위 링크에 걸어둔 방법으로 DB에 데이터들을 저장 하고 페이지에서 화장실 위치를 불러오던중 DB에 있는 화장실 들이 출력이 안되는 안되는 상황이 발생했다.
엑셀 파일을 자세히 보니 이런식으로 데이터들중 위도와 경도가 없는것들이 엄~~청 많이 있었다.

![image](https://github.com/user-attachments/assets/94462268-3430-4835-b699-190b0c4ed044)

이것을 해결하기 위해 위,경도가 없는 데이터들이 갖고있는 주소를 위경도로 변경하는 작업을 시작했는데, 서울시 데이터만 5000개 이상인데다 위경도가 없는 데이터들을 일일이 검색해서 적을순 없어서
csv파일을 읽어와 반복문으로 위경도가 있는 데이터는 그대로 다시 넣고, 없는 데이터는 주소를 검색 후 위경도를 추가해서 넣어주는 방식으로 진행했다.

위경도를 찾아서 넣는 작업은 찾다보니 주소를 입력하면 위경도를 알려주는 페이지가 있어서 아래링크를 통해서 작업을 했음!( 카카오 주소찾기는 사용량 제한이 있는줄 알았는데 없다는걸 지금 알았음..)  
([주소 위,경도 변환한곳!](https://deveapp.com/map.php))

#### csv 파일 읽어오기

node.js의 fs모듈과 경로를 읽어올 path모듈을 사용해 csv파일을 읽어올수 있다.

<br />
`path`의 join 메서드는 아래처럼 파라미터를 갖는다.

![image](https://github.com/user-attachments/assets/89ae41e6-d13b-4b6d-80d2-02a9fd9011b3)

```ts
import fs from "fs";
import path from "path";

const name = "test.csv";
const readPath = path.join(
  process.cwd(), // 현재 작업 디렉터리의 경로 (루트폴더)
  "src", // 경로
  "app", // 경로
  "api", // 경로
  "testDB", // 경로
  name // csv파일
);

const csv = fs.readFileSync(readPath, "utf-8"); // 문자열 반환
```

<br />

이렇게 csv파일을 읽어오면 아래처럼 문자열로 쭈우욱 나오는데 이제 이 문자열을 `split`을 사용해 줄바꿈을 기준으로 배열을 만들어 주면 된다!

![image](https://github.com/user-attachments/assets/2b02bd82-4758-4005-beca-775657d65f84)

그렇게 만든 배열을 반복문을 돌려 위에서 말한 내용대로 작업을 해 새로운 배열에 넣어 새로운 csv 파일에 써주고 DB에 저장해주면 되는데!

#### csv파일 쓰기

파일 경로 읽어오는건 위에 작성했으니 쓰는 방법만 쓰겠다!
<br />

```ts
fs.writeFile(파일경로,csv파일에 넣을 데이터, 옵션, 콜백)

// 파일경로 : 데이터를 넣을 csv파일
// 데이터 : csv파일에 쓸 데이터
// 옵션 : 파일 쓰기 옵션 ex) 인코딩방식 utf-8, ascii, base64등
// 콜백 : 파일쓰기가 완료된후 호출됨 파일쓰기 과정에서 발생한 오류를 처리하는데 사용
```

<br />
이렇게 하면 데이터가 다 멀쩡히 들어갈 줄 알았는데 여전히 데이터가 화면에 보이지 않았다 그래서 뭐가 또 문제인가 하고 보니!! 다음 문제가 있었던것!

<br />

### 2. 데이터 안에 줄바꿈 또는 쉼표가 들어가 있는 경우

#### 셀값에 쉼표가 있는 경우

csv파일을 읽어오면 위에 사진에서 봤듯이 엑셀파일에서 한 열(Column)에서의 행들을 쉼표로 구분한다. 예를들면 아래 표가 엑셀,csv 파일 이라고 가정 하고 위방식대로 읽어오면

| id       | name | age |
| -------- | ---- | --- |
| aksen123 | park | 20  |

```js
"id,name,age\n" + "aksen123,park,20";

// 배열로 만들었을때
["id,name,age", "aksen123,park,20"];
```

<br />

이런식으로 읽어 오게 되는데! 셀안의 값에 쉼표가 들어가게 된다묜 아래처럼 읽게 된다

| id        | name | age |
| --------- | ---- | --- |
| aksen,123 | park | 20  |

```js
"id,name,age\n" + "aksen,123,park,20";

// 배열로 만들었을때
["id,name,age", "aksen", "123,park,20"];
```

<br />
이런식으로 읽어오게 되면 문제가 생길수 있는데, 읽어온 csv파일을 배열로 만들어 반복문을 돌릴때 해당 데이터의 위도,경도가 있고 없는지를 확인하기 위해 각 문자열을 다시한번 쉼표를 기준으로 쪼개 배열을 만들기 때문인데(배열의 n번째 요소가 위도 이기 때문) 셀안에 저렇게 쉼표가 들어가 있는 데이터들도 생각보다 꽤 많았다.

#### 셀값에 줄바꿈이 있는경우

쉼표와 마찬가지로 줄바꿈이 있으면 csv파일 자체를 배열로 만들면(split을 사용해 줄바꿈을 기준으로 배열을 만듦) 열(Column)로 구분 되는게 아니라 뒤죽박죽 섞여서 배열이 만들어 지게 된다.

| id              | name | age |
| --------------- | ---- | --- |
| aksen <br />123 | park | 20  |

```js
"id,name,age\n" + "aksen\n" + "123,park,20";

// 배열로 만들었을때
let test1 = ["id,name,age", "aksen", "123,park,20"];
// 줄바꿈이 없을 때
let test2 = ["id,name,age", "aksen123,park,20"];
```

### 해결 방법 ??

이런 두가지 문제를 겪었고 이걸 코드로 해야한다는 생각을 계속 하고 있다가 굳이? 그럴 필요가 있을까 싶다는 생각에 그냥 엑셀파일에서 쉼표와 줄바꿈을 띄어쓰기로 바꾼뒤 csv파일로 변환해서 넣는 방식으로 결정했다.

쉼표와 줄바꿈을 코드로 띄어쓰기로 바꾸는건 내가 아직할 수 없는??것 같았다 왜냐면 csv파일을 갖고와 배열을 만드는 기준이 되는 값들이 쉼표와 줄바꿈 이기 때문에 이값을 띄어 쓰기로 바꾸면 원래멀쩡히 있던 줄바꿈과 쉼표도 다 바뀌게 되니... 이런 생각을 갖고 그냥 엑셀파일 자체에서 변경하게 된것인데 이건 나중에 자동화를 위해서라도 변경하는 방법을 찾아봐야겠다.
